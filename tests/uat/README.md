# メルカリ風C2Cサービス UAT（ユーザーアクセプタンステスト）

## 概要

メルカリ風C2Cサービスのユーザーアクセプタンステスト（UAT）フレームワークです。実際のユーザーの視点から、システムがビジネス要件を満たしているかを自動的に検証します。

## 構成

### 📁 ファイル構成

```
tests/uat/
├── README.md                    # このファイル
├── test_uat_requirements.md     # UAT要件定義書
├── test_data_generator.py       # テストデータ生成スクリプト
├── uat_test_cases.py           # UATテストケース定義
├── uat_automation.py           # UAT自動化フレームワーク
├── uat_config.json             # 設定ファイル
├── run_uat.py                  # UAT実行スクリプト
└── uat_reports/                # レポート出力ディレクトリ
    ├── uat_test_report.html    # HTMLレポート
    ├── uat_test_results.json   # JSONレポート
    └── uat_test_data.json      # テストデータ
```

### 🧪 テストケース

#### 機能テスト
- **UC-001**: 新規ユーザー登録
- **UC-002**: ユーザーログイン
- **UC-005**: 商品出品
- **UC-006**: 商品検索
- **UC-009**: 商品購入
- **UC-010**: 取引履歴表示
- **UC-012**: 管理者機能

#### 非機能テスト
- **PERF-001**: パフォーマンステスト
- **SEC-001**: セキュリティテスト

## 使用方法

### 🚀 基本的な使用方法

#### 1. 完全なUAT実行
```bash
cd tests/uat
python run_uat.py
```

#### 2. テストデータ生成のみ
```bash
python run_uat.py --data-only
```

#### 3. テスト実行のみ
```bash
python run_uat.py --test-only
```

#### 4. 高優先度テストのみ実行
```bash
python run_uat.py --priority High
```

### ⚙️ 設定ファイルの使用

#### 1. 設定ファイルを指定して実行
```bash
python run_uat.py --config my_config.json
```

#### 2. 設定情報を表示
```bash
python run_uat.py --show-config
```

### 📋 テストケース管理

#### 1. テストケース一覧を表示
```bash
python run_uat.py --list-cases
```

#### 2. 詳細なログを表示
```bash
python run_uat.py --verbose
```

### 🔧 個別スクリプトの実行

#### 1. テストデータ生成
```bash
python test_data_generator.py
```

#### 2. テストケース実行
```bash
python uat_test_cases.py
```

#### 3. 自動化フレームワーク実行
```bash
python uat_automation.py
```

## 設定

### 📄 設定ファイル (uat_config.json)

```json
{
  "database": {
    "path": "uat_test.db",
    "backup": true,
    "cleanup": true
  },
  "test_data": {
    "users_count": 6,
    "products_count": 50,
    "transactions_count": 30,
    "messages_count": 20,
    "reviews_count": 15
  },
  "test_execution": {
    "run_all": true,
    "priority_filter": null,
    "timeout": 300,
    "parallel_execution": false,
    "retry_failed_tests": true,
    "max_retries": 3
  },
  "performance": {
    "login_timeout": 5.0,
    "search_timeout": 3.0,
    "display_timeout": 2.0,
    "memory_limit": "512MB"
  },
  "reporting": {
    "generate_html": true,
    "generate_json": true,
    "generate_xml": false,
    "output_dir": "uat_reports",
    "include_screenshots": false,
    "detailed_logs": true
  }
}
```

### 🔧 設定項目の説明

#### データベース設定
- `path`: テスト用データベースファイルのパス
- `backup`: 実行前にデータベースをバックアップするか
- `cleanup`: 実行後にデータベースをクリーンアップするか

#### テストデータ設定
- `users_count`: 生成するユーザー数
- `products_count`: 生成する商品数
- `transactions_count`: 生成する取引数
- `messages_count`: 生成するメッセージ数
- `reviews_count`: 生成するレビュー数

#### テスト実行設定
- `run_all`: 全テストを実行するか
- `priority_filter`: 実行する優先度フィルター
- `timeout`: テスト実行のタイムアウト時間（秒）
- `parallel_execution`: 並列実行するか
- `retry_failed_tests`: 失敗したテストをリトライするか
- `max_retries`: 最大リトライ回数

#### パフォーマンス設定
- `login_timeout`: ログイン処理のタイムアウト時間
- `search_timeout`: 検索処理のタイムアウト時間
- `display_timeout`: 表示処理のタイムアウト時間
- `memory_limit`: メモリ使用量制限

#### レポート設定
- `generate_html`: HTMLレポートを生成するか
- `generate_json`: JSONレポートを生成するか
- `generate_xml`: XMLレポートを生成するか
- `output_dir`: レポート出力ディレクトリ
- `include_screenshots`: スクリーンショットを含めるか
- `detailed_logs`: 詳細ログを出力するか

## テストケース詳細

### 👤 ユーザー管理テスト

#### UC-001: 新規ユーザー登録
**目的**: 新規ユーザーがアカウントを作成できることを確認

**テストステップ**:
1. 新規登録画面を開く
2. 必須項目を入力する
3. 登録ボタンをクリックする
4. 重複ユーザー名で登録を試行する

**期待結果**:
- 登録フォームが表示される
- 入力値が正しく設定される
- ユーザーが正常に登録される
- エラーメッセージが表示される

#### UC-002: ユーザーログイン
**目的**: 登録済みユーザーがログインできることを確認

**テストステップ**:
1. ログイン画面を開く
2. 正しい認証情報を入力する
3. 間違った認証情報を入力する
4. ログアウトを実行する

**期待結果**:
- ログインフォームが表示される
- ログインが成功する
- エラーメッセージが表示される
- ログアウトが成功する

### 📦 商品管理テスト

#### UC-005: 商品出品
**目的**: ログイン済みユーザーが商品を出品できることを確認

**テストステップ**:
1. 出品画面を開く
2. 商品情報を入力する
3. 出品ボタンをクリックする
4. 必須項目を空にして出品を試行する

**期待結果**:
- 出品フォームが表示される
- 入力値が正しく設定される
- 商品が正常に出品される
- エラーメッセージが表示される

#### UC-006: 商品検索
**目的**: ユーザーが商品を検索できることを確認

**テストステップ**:
1. 検索画面を開く
2. キーワードで検索する
3. カテゴリで検索する
4. 価格範囲で検索する

**期待結果**:
- 検索フォームが表示される
- 該当商品が表示される
- 該当カテゴリの商品が表示される
- 該当価格の商品が表示される

### 💰 取引管理テスト

#### UC-009: 商品購入
**目的**: ユーザーが商品を購入できることを確認

**テストステップ**:
1. 商品詳細画面を開く
2. 購入ボタンをクリックする
3. 購入を確認する
4. 取引履歴を確認する

**期待結果**:
- 商品情報が表示される
- 購入確認ダイアログが表示される
- 取引が作成される
- 取引が履歴に表示される

#### UC-010: 取引履歴表示
**目的**: ユーザーが取引履歴を確認できることを確認

**テストステップ**:
1. マイページを開く
2. 購入履歴を確認する
3. 出品履歴を確認する

**期待結果**:
- 取引履歴が表示される
- 購入した商品が表示される
- 出品した商品が表示される

### 👨‍💼 管理者機能テスト

#### UC-012: 管理者機能
**目的**: 管理者がシステム管理機能を使用できることを確認

**テストステップ**:
1. 管理者でログインする
2. 統計情報を確認する
3. システム情報を確認する

**期待結果**:
- 管理者画面が表示される
- ユーザー数、商品数、取引数が表示される
- システム状態が表示される

### ⚡ パフォーマンステスト

#### PERF-001: パフォーマンステスト
**目的**: システムのパフォーマンス要件を満たしていることを確認

**テストステップ**:
1. ログイン処理の時間を測定する
2. 商品検索の時間を測定する
3. 商品一覧表示の時間を測定する

**期待結果**:
- 5秒以内に完了する
- 3秒以内に完了する
- 2秒以内に完了する

### 🔒 セキュリティテスト

#### SEC-001: セキュリティテスト
**目的**: システムのセキュリティ要件を満たしていることを確認

**テストステップ**:
1. パスワードハッシュ化を確認する
2. 未認証アクセスをテストする
3. SQLインジェクションをテストする

**期待結果**:
- パスワードがハッシュ化される
- 適切にアクセスが拒否される
- 攻撃が防がれる

## レポート

### 📊 レポートの種類

#### 1. HTMLレポート
- 視覚的に分かりやすいレポート
- テスト結果の詳細表示
- グラフとチャート
- ブラウザで表示可能

#### 2. JSONレポート
- 機械可読な形式
- 他のツールとの連携
- 詳細なデータ構造
- API連携用

#### 3. XMLレポート
- 標準的な形式
- CI/CDツールとの連携
- 詳細なメタデータ
- 企業システムとの連携

### 📈 レポートの内容

#### サマリー情報
- 総テスト数
- 成功/失敗数
- 成功率
- 実行時間

#### 詳細情報
- 各テストケースの結果
- 実行時間
- エラーメッセージ
- テストステップの結果

#### 統計情報
- 優先度別の結果
- 機能別の結果
- パフォーマンス統計
- セキュリティ統計

## 受け入れ基準

### ✅ 成功基準

#### 機能要件
- すべての受け入れ基準を満たす
- クリティカルパスが正常に動作する
- エラーハンドリングが適切に機能する

#### 非機能要件
- パフォーマンス要件を満たす
- ユーザビリティ要件を満たす
- セキュリティ要件を満たす

#### 品質基準
- テスト実行成功率 95%以上
- クリティカルバグ 0件
- マイナーバグ 5件以下

### ❌ 失敗基準

#### 機能要件
- 受け入れ基準を満たさない
- クリティカルパスが動作しない
- エラーハンドリングが不適切

#### 非機能要件
- パフォーマンス要件を満たさない
- ユーザビリティ要件を満たさない
- セキュリティ要件を満たさない

#### 品質基準
- テスト実行成功率 95%未満
- クリティカルバグ 1件以上
- マイナーバグ 6件以上

## トラブルシューティング

### 🔧 よくある問題

#### 1. データベース接続エラー
```bash
# エラー: DB接続エラー: unable to open database file
# 解決方法: データベースファイルの権限を確認
chmod 644 uat_test.db
```

#### 2. テストデータ生成エラー
```bash
# エラー: テーブル作成エラー
# 解決方法: データベースをクリーンアップ
rm uat_test.db
python test_data_generator.py
```

#### 3. テスト実行エラー
```bash
# エラー: モジュールインポートエラー
# 解決方法: パスを確認
export PYTHONPATH=$PYTHONPATH:$(pwd)/../../
```

#### 4. レポート生成エラー
```bash
# エラー: ファイル書き込みエラー
# 解決方法: 出力ディレクトリの権限を確認
mkdir -p uat_reports
chmod 755 uat_reports
```

### 🐛 デバッグ方法

#### 1. 詳細ログの有効化
```bash
python run_uat.py --verbose
```

#### 2. 個別テストの実行
```bash
python uat_test_cases.py
```

#### 3. 設定ファイルの確認
```bash
python run_uat.py --show-config
```

#### 4. テストケース一覧の確認
```bash
python run_uat.py --list-cases
```

## 今後の拡張

### 🚀 予定されている機能

#### 1. 視覚的テスト
- スクリーンショット比較
- UI要素の検証
- レイアウトテスト

#### 2. 統合テスト
- API連携テスト
- 外部サービス連携テスト
- データベース統合テスト

#### 3. 負荷テスト
- 同時ユーザーテスト
- 大量データテスト
- ストレステスト

#### 4. セキュリティテスト
- 脆弱性スキャン
- ペネトレーションテスト
- セキュリティ監査

### 📊 メトリクス拡張

#### 1. カバレッジ分析
- 機能カバレッジ
- コードカバレッジ
- 要件カバレッジ

#### 2. パフォーマンス分析
- レスポンス時間分析
- スループット分析
- リソース使用量分析

#### 3. 品質分析
- バグ密度分析
- 欠陥傾向分析
- 品質トレンド分析

## まとめ

このUATフレームワークは、メルカリ風C2Cサービスの品質を保証するための包括的なテストソリューションです。自動化されたテスト実行、詳細なレポート生成、柔軟な設定オプションにより、効率的で信頼性の高いテストを実現します。

継続的な改善と拡張により、より高品質なソフトウェアの提供を目指します。
